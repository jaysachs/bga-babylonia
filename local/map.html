<html>
  <link rel="stylesheet" type="text/css" href="../babylonia.css" />
  <script>
    var currentColor = 3;
    function cycleThings(e) {
	let colors = [
	    "wood",
	    "blue",
	    "white",
	    "grey",
	];
	let pieces = [
	    "farmer",
	    "merchant",
	    "servant",
	    "priest",
	    "blank"
	];
 	let cities = [
	    "city_msp",
	    "city_m",
	    "city_back",
	    "city_p",
	    "city_s",
	    "city_ms",
	    "city_sp",
	    "city_mp",
	    "farm_5",
	    "farm_6",
	    "farm_7",
	    "farm_X",
	    "ziggurat",
	];

	cc = e.parentElement.classList;
	c = e.classList;
	cc.add(colors[currentColor]);
	for (i = 0; i < pieces.length; ++i) {
	    if (c.contains(pieces[i])) {
		c.remove(pieces[i]);
		if (i < pieces.length-1) {
		    c.add(pieces[i+1]);
		} else {
		    c.remove("piece");
		    c.add("city");
		    c.add(cities[0]);
		    cc.remove(colors[currentColor]);
		}
		return;
	    }
	}
	cc.remove(colors[currentColor]);
	for (i = 0; i < cities.length; ++i) {
	    if (c.contains(cities[i])) {
		c.remove(cities[i]);
		if (i < cities.length-1) {
		    c.add(cities[i+1]);
		    return;
		} else {
		    c.remove("city");
		    break;
		}
	    }
	}
	currentColor++;
	if (currentColor == colors.length) {
	    currentColor = 0;
	}
	cc.add(colors[currentColor]);
	c.add(pieces[0]);
	c.add("piece");
    }

    function selectHex(event) {
        event.preventDefault();
	event.stopPropagation();
	let e = event.target;
	while (e.parentElement != null && e.parentElement.id != "board") {
	    e = e.parentElement;
	}
	if (e.parentElement != null) {
	    let x = e.id.split("_");
	    console.log("selected hex " + x[1] + ", " + x[2]);
	    // e.classList.toggle("selected");
	    cycleThings(e.firstElementChild);
	}
    }

    function selectPieceToPlay(event) {
        event.preventDefault();
	event.stopPropagation();
	let e = event.target;
	let hc = e.parentElement;
	if (hc.id == "hand") {
	    let c = e.classList;
	    if (c.length == 0) {
		return;
	    }
	    if (!c.contains("selected")) {
                hc.querySelectorAll('.selected').forEach(div => div.classList.remove('selected'));
	    }
	    c.toggle("selected");
	}
    }
  </script>
  <body style="background-color: #CCFFCC">
    <div id="main">
      <div style="width: 1024px; display: flex; flex-direction:row; flex-wrap: nowrap; justify-content:center;">
	<div class="hand blue" id="hand" onClick="selectPieceToPlay(event)">
          <div id="hand_0" class="farmer"></div>
          <div id="hand_1"  class="priest"></div>
	  <!-- this one was already played -->
	  <div id="hand_2"  class=""></div>
	  <div  id="hand_3" class="farmer" foo=""></div>
	  <div  id="hand_4" class="merchant"></div>
	  <div  id="hand_5" class="unavailable"></div>
	  <div  id="hand_6" class="unavailable"></div>
	</div>
      </div>
      <div class="board-spacer"></div>
      <div class="board" id="board" onClick="selectHex(event)">
	<script>
	  let c = document.getElementById("board");
	  for (let j = 0; j < 16; j++) {
	      let odd = j % 2 == 0;
	      let rows = odd ? 12 : 11;
	      for (let i = 0; i < rows; i++) {
		  let top = i * 63 + (odd ? 6 : 37);
		  let left = 38 + (j * 55);
		  c.insertAdjacentHTML(
		      `beforeend`,
		      `<div id="hex_${i}_${j}" style="top:${top}px; left:${left}px;"><div></div></div>`
		  );
	      }
	  }

	  /*
	  for (i = 0; i < 7; ++i) {
	      console.log(i);
	      let h = document.getElementById("hand_" + i);
	      let d = h.classList;

	      console.log(d);
	      d.keys().forEach((x,y) => d.remove(x));
	      console.log(d);
	      h.className = "";
	      console.log(h.classList);
	      }
	  */
	  // for (i = 0; i < gamedatas.hand.length; ++i) {
	  //     let p = gamedatas.hand[i];
	  //     let c = document.getElementById("hand_" + i).classList;
	  //     c.add(p);
	  // }

	  </script>
      </div>
    </div>
    <h1>More Stuff HERE</h1>
    yes, here it is.
  </body>
</html>
