<html>
  <link rel="stylesheet" type="text/css" href="babylonia.css" />
  <script>
    function cyclePieces(c) {
	let tiles = [
	    "farmer",
	    "merchant",
	    "servant",
	    "priest",
	    "blank"
	];
	for (i = 0; i < tiles.length; ++i) {
	    if (c.contains(tiles[i])) {
		c.remove(tiles[i]);
		if (i < tiles.length-1) {
		    c.add(tiles[i+1]);
		}
		return;
	    }
	}
	c.add(tiles[0]);
    }

    function cycleCities(c) {
	let tiles = [
	    "city-msp",
	    "city-m",
	    "city-back",
	    "city-p",
	    "city-s",
	    "city-ms",
	    "city-sp",
	    "city-mp",
	    "farm5",
	    "farm6",
	    "farm7",
	    "farmX"
	];
	for (i = 0; i < tiles.length; ++i) {
	    if (c.contains(tiles[i])) {
		c.remove(tiles[i]);
		if (i < tiles.length-1) {
		    c.add(tiles[i+1]);
		}
		return;
	    }
	}
	c.add(tiles[0]);
    }
    
    function selectHex(event) {
        event.preventDefault();
	event.stopPropagation();
	let e = event.target;
	while (e.parentElement != null && e.parentElement.id != "container") {
	    e = e.parentElement;
	}
	if (e.parentElement != null) {
	    let x = e.id.split("_");
	    console.log("selected hex " + x[1] + ", " + x[2]);
	    // e.classList.toggle("selected");
	    let c = e.firstElementChild.classList;
	    if (x[2] % 2 == 0) {
		cyclePieces(c);
	    } else {
		cycleCities(c);
	    }
	}
    }

    function selectPieceToPlay(event) {
        event.preventDefault();
	event.stopPropagation();
	let e = event.target;
	let hc = e.parentElement.parentElement;
	if (hc.id == "hand") {
	    let c = e.parentElement.classList;
	    if (c.contains("unplayable")) {
		return;
	    }
	    if (!c.contains("selected")) {
                hc.querySelectorAll('.selected').forEach(div => div.classList.remove('selected'));
	    }
	    c.toggle("selected");
	}
    }
  </script>
  <body>
    <div class="main">
      <div style="display: inline">
	<div class="handlabel">Hand:</div>
	<div class="hand" id="hand" onClick="selectPieceToPlay(event)">
	  <div>
	    <div class="farmer"></div>
	  </div>
	  <div class="selected">
	    <div class="priest"></div>
	  </div>
	  <div class="unplayable">
	    <div class="merchant"></div>
	  </div>
	  <div>
	    <div class="farmer"></div>
	  </div>
	  <div>
	    <div class="merchant"></div>
	  </div>
	  <div></div>
	  <div></div>
	</div>
      </div>
      <div class="container" id="container" onClick="selectHex(event)">
	<script>
	  let c = document.getElementById("container");
	  for (let j = 0; j < 9; j++) {
	      for (let i = 0; i < 12; i++) {
		  let top = i * 63 + 6;
		  let left = 39 + (j * 110);
		  c.insertAdjacentHTML(
		      `beforeend`,
		      `<div id="hex_${i}_${j*2}" style="top:${top}px; left:${left}px;"><div></div></div>`
		  );
	      }
	  }
	  for (let j = 0; j < 8; j++) {
	      for (let i = 0; i < 11; i++) {
		  let top = i * 63 + 37;
		  let left = 93 + (j * 110);
		  c.insertAdjacentHTML(
		      `beforeend`,
		      `<div id="hex_${i+1}_${1+j*2}" style="top:${top}px; left:${left}px;"><img></img></div>`
		  );
	      }
	  }
	</script>
      </div>
    </div>
  </body>
</html>
