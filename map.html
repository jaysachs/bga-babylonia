<html>
  <link rel="stylesheet" type="text/css" href="babylonia.css" />
  <script>
    var currentColor = 0;
    function cycleThings(e) {
	let colors = [
	    "wood",
	    "blue",
	    "white",
	    "grey",
	];
	let pieces = [
	    "farmer",
	    "merchant",
	    "servant",
	    "priest",
	    "blank"
	];
 	let cities = [
	    "city_msp",
	    "city_m",
	    "city_back",
	    "city_p",
	    "city_s",
	    "city_ms",
	    "city_sp",
	    "city_mp",
	    "farm_5",
	    "farm_6",
	    "farm_7",
	    "farm_X"
	];

	cc = e.parentElement.classList;
	c = e.classList;
	cc.add(colors[currentColor]);
	for (i = 0; i < pieces.length; ++i) {
	    if (c.contains(pieces[i])) {
		c.remove(pieces[i]);
		if (i < pieces.length-1) {
		    c.add(pieces[i+1]);
		} else {
		    c.remove("piece");
		    c.add("city");
		    c.add(cities[0]);
		    cc.remove(colors[currentColor]);
		}
		return;
	    }
	}
	cc.remove(colors[currentColor]);
	for (i = 0; i < cities.length; ++i) {
	    if (c.contains(cities[i])) {
		c.remove(cities[i]);
		if (i < cities.length-1) {
		    c.add(cities[i+1]);
		    return;
		} else {
		    c.remove("city");
		    break;
		}
	    }
	}
	currentColor++;
	if (currentColor == colors.length) {
	    currentColor = 0;
	}
	cc.add(colors[currentColor]);
	c.add(pieces[0]);
	c.add("piece");
    }

    function selectHex(event) {
        event.preventDefault();
	event.stopPropagation();
	let e = event.target;
	while (e.parentElement != null && e.parentElement.id != "container") {
	    e = e.parentElement;
	}
	if (e.parentElement != null) {
	    let x = e.id.split("_");
	    console.log("selected hex " + x[1] + ", " + x[2]);
	    // e.classList.toggle("selected");
	    cycleThings(e.firstElementChild);
	}
    }

    function selectPieceToPlay(event) {
        event.preventDefault();
	event.stopPropagation();
	let e = event.target;
	let hc = e.parentElement.parentElement;
	if (hc.id == "hand") {
	    let c = e.parentElement.classList;
	    if (c.contains("unplayable")) {
		return;
	    }
	    if (!c.contains("selected")) {
                hc.querySelectorAll('.selected').forEach(div => div.classList.remove('selected'));
	    }
	    c.toggle("selected");
	}
    }
  </script>
  <body>
    <div class="main">
      <div style="display: inline">
	<div class="handlabel">Hand:</div>
	<div class="hand wood" id="hand" onClick="selectPieceToPlay(event)">
	  <div>
	    <div class="farmer"></div>
	  </div>
	  <div class="selected">
	    <div class="priest"></div>
	  </div>
	  <div class="unplayable">
	    <div class="merchant"></div>
	  </div>
	  <div>
	    <div class="farmer"></div>
	  </div>
	  <div>
	    <div class="merchant"></div>
	  </div>
	  <div></div>
	  <div></div>
	</div>
      </div>
      <div class="container" id="container" onClick="selectHex(event)">
	<script>
	  let c = document.getElementById("container");
	  for (let j = 0; j < 16; j++) {
	      let odd = j % 2 == 0;
	      let rows = odd ? 12 : 11;
	      for (let i = 0; i < rows; i++) {
		  let top = i * 63 + (odd ? 6 : 37);
		  let left = 39 + (j * 55);
		  c.insertAdjacentHTML(
		      `beforeend`,
		      `<div id="hex_${i}_${j}" style="top:${top}px; left:${left}px;"><div></div></div>`
		  );
	      }
	  }
	</script>
      </div>
    </div>
  </body>
</html>
